dbsize

### 特点与注意事项

1. **时间复杂度**：`O(1)`，直接返回 Redis 内部维护的键数量计数器，性能极高。
2. **只统计当前库**：Redis 默认有 16 个数据库（0-15），`DBSIZE` 仅返回当前选中数据库（默认是 0 号库）的键数量，需用 `SELECT 库编号` 切换数据库后再查询。
3. **不包含过期键的特殊情况**：即使键已过期但未被删除（如等待惰性删除或定期删除），`DBSIZE` 仍会统计（因为过期键在物理上仍存在于数据库中）。

### 适用场景

- 快速了解数据库的键数量规模，判断是否存在键数量异常增长。
- 结合内存信息（如 `info memory`）分析 “平均每个键的内存占用”（`used_memory_dataset / DBSIZE`），辅助判断是否有大键或内存浪费。

例如，若 `DBSIZE` 返回 100 万，`used_memory_dataset` 为 500MB，则平均每个键占用约 500 字节，可初步判断键的内存分布是否合理。



client info 

client list

client kill命令杀掉这个连接，

info memory

info stats



可以使用info replication命令查看复制相关



monitor命令

`MONITOR` 是 Redis 中一个用于**实时监控所有客户端发送的命令**的调试命令，执行后会将服务器接收到的每一条命令（包括来源客户端、时间、具体命令内容）实时打印出来，常用于排查业务问题或跟踪命令执行流程。

1. **严重影响性能**：
   - `MONITOR` 会将所有命令实时打印到输出流，在高 QPS 场景（如每秒数万条命令）下，会占用大量 CPU 和网络带宽，导致 Redis 响应延迟飙升，甚至阻塞主线程。
   - **生产环境禁止长期执行**，建议仅在低峰期短暂使用（如 10-30 秒），并立即关闭。

在 Redis 中，“慢查询” 指的是**执行时间超过预设阈值（默认 10 毫秒）的命令**。这些命令会占用 Redis 主线程过长时间，导致其他命令排队等待，最终引发 Redis 阻塞（无法及时响应正常请求），是影响 Redis 性能的常见问题之一。



用dmesg查看进程状态，发现

[32586.989320] kb_game[16984]: segfault at 0 ip 00000000006dc8f6 sp 00007f0be129e480 error 4 in kb_game[400000+3bb000]

[s00_dub3hf20h20dfno3fdaiq@ip-172-31-13-118 kb_game]$ addr2line -e kb_game -f -C 006dc8f6
CRedisConnection::ConnRequest(CRedisCommand*)
/root/u_test_4/CCReactor/./comm/RedisClient.cpp:686

发现是redis断开连接了

